<!DOCTYPE html>
<html lang="zh-CN">







<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>Home Assistant 系列——设备接入篇 | 庄菲什</title>

	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
	<meta name="generator" content="hexo">
	<meta name="author" content="drunkfish">
	<meta name="description" content="">

	

	

	

	

	

	<meta property="og:site_name" content="庄菲什">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Home Assistant 系列——设备接入篇 | 庄菲什">
	<meta property="og:description" content="">
	<meta property="og:url" content="http://yoursite.com/ha2/">

	
	<meta property="article:published_time" content="2020-02-09T00:02:00+08:00"/> 
	<meta property="article:author" content="drunkfish">
	<meta property="article:published_first" content="庄菲什, /ha2/" />
	

	
	
	
<link rel="stylesheet" href="/css/allinonecss.min.css">


	
	
	
<link rel="alternate" href="/atom.xml" title="庄菲什" type="application/atom+xml">
</head>
<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">HOME</a>
                
            </li>
            
        </ul> 
    </div>
     
    <div class="site-nav-right">
         
        
<div class="social-links" >
    
    
    
    
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time  class="post-full-meta-date" datetime="2020-02-09T00:00:00.000Z">
                    2020-02-9
                </time>
                
                <span class="date-divider">/</span>
                
                
            </div>
            <h1 class="post-full-title">Home Assistant 系列——设备接入篇</h1>
        </header>
        <div class="post-full no-image">
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_cover.png" alt="ha2_cover"></p>
<p><a href="https://www.home-assistant.io/" target="_blank" rel="noopener">Home Assistant</a> 支持大部分主流智能硬件，列表见<a href="https://www.home-assistant.io/integrations/" target="_blank" rel="noopener">这里</a>。下面是小弟验证可以接入的：</p>
<h2 id="接入设备"><a href="#接入设备" class="headerlink" title="接入设备"></a>接入设备</h2><h3 id="米家-WiFi-插座"><a href="#米家-WiFi-插座" class="headerlink" title="米家 WiFi 插座"></a>米家 WiFi 插座</h3><p>米家 WiFi 插座有分基础板（带一个开关）、增强版（带一个开关、一个 USB 口），接入 Home Assistant 方法相似：</p>
<ol>
<li><p>获取设备 IP 地址、token<br>下载俄罗斯大大的<a href="https://www.kapiba.ru/2017/11/mi-home.html" target="_blank" rel="noopener">修改版米家 App</a>（仅支持 Android 系统，可免 root 直接获取米家设备 token），按照 App 内说明将插座连入。接入后接入设备详情页面，点击右上角「三个点」进入「设置」，在「设置」中找到「附加设置」，在「附加设置」中进入「网络信息」，在网络信息中可以看到设备 IP 地址及 token，复制保存。</p>
</li>
<li><p>下载这位大大的<a href="https://github.com/syssi/xiaomiplug" target="_blank" rel="noopener">源码</a>到本地，</p>
</li>
<li><p>打开群晖保存 Home Assistant 配置文件的路径，将下载的源码中<code>/custom_components</code> 路径下的文件复制到相同名称的路径下，用文本编辑器打开 configuration.yaml 文件，添加以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># configuration.yaml</span><br><span class="line"></span><br><span class="line">switch:</span><br><span class="line">  - platform: xiaomi_miio</span><br><span class="line">    name: Original Xiaomi Mi Smart WiFi Socket</span><br><span class="line">    host: 192.168.130.59</span><br><span class="line">    token: b7c4a758c251955d2c24b1d9e41ce47d</span><br><span class="line">    model: chuangmi.plug.m1</span><br><span class="line">  - platform: xiaomi_miio</span><br><span class="line">    name: Xiaomi Mi Smart Power Strip</span><br><span class="line">    host: 192.168.130.60</span><br><span class="line">    token: 0ed0fdccb2d0cd718108f18a447726a6</span><br><span class="line">    model: zimi.powerstrip.v2</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<ul>
<li><strong>host</strong> (必填): 设备 IP 地址。</li>
<li><strong>token</strong> (必填): 设备 token。</li>
<li><strong>name</strong> (选填): 可任意名字。</li>
<li><strong>model</strong> (选填): 设备型号，可填入的值： <code>chuangmi.plug.v1</code>, <code>chuangmi.plug.v3</code>, <code>qmi.powerstrip.v1</code>, <code>zimi.powerstrip.v2</code>, <code>chuangmi.plug.m1</code>, <code>chuangmi.plug.m3</code>, <code>chuangmi.plug.v2</code>, <code>chuangmi.plug.hmi205</code> 和 <code>lumi.acpartner.v3</code>。 填入后可以繞過設備型號檢測，如果設備並接入有问题，建議填入此项。</li>
</ul>
</li>
</ol>
<p>打开群晖保存 Home Assistant 配置文件的路径，将下载的源码中<code>/custom_components</code> 路径下的文件复制到相同名称的路径下，用文本编辑器打开 configuration.yaml 文件，添加以下代码：</p>
<ol start="4">
<li>重新载入设备，若日志中不报错则成功接入。</li>
</ol>
<h3 id="米家空调伴侣"><a href="#米家空调伴侣" class="headerlink" title="米家空调伴侣"></a>米家空调伴侣</h3><p>米家空调伴侣有分带 Zigbee 模块和不带 Zigbee 模块，接入方法相似：</p>
<ol>
<li><p>获取设备 IP 地址、token，参考 WiFi 插座，若想接入空调，在 App 内接入空调，</p>
</li>
<li><p>下载<a href="https://github.com/syssi/xiaomi_airconditioningcompanion" target="_blank" rel="noopener">源码</a>到本地，</p>
</li>
<li><p>打开群晖保存 Home Assistant 配置文件的路径，将下载的源码中的文件复制到<code>/custom_components</code> 路径下，用文本编辑器打开 configuration.yaml 文件，添加以下代码：</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># configuration.yaml</span><br><span class="line"></span><br><span class="line">climate:</span><br><span class="line">  - platform: xiaomi_miio_airconditioningcompanion</span><br><span class="line">    name: Aqara Air Conditioning Companion</span><br><span class="line">    host: 192.168.130.71</span><br><span class="line">    token: b7c4a758c251955d2c24b1d9e41ce47d</span><br><span class="line">    target_sensor: sensor.temperature_158d0001f53706</span><br><span class="line">    scan_interval: 60</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>若要接入内置的 Zigbee 网关，可以参考<a href="https://www.home-assistant.io/integrations/xiaomi_aqara/" target="_blank" rel="noopener">这里</a>。在 configuration.yaml 文件，添加以下代码：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xiaomi_aqara:</span><br><span class="line">  discovery_retry: 5</span><br><span class="line">  gateways:</span><br></pre></td></tr></table></figure>
<p>网关接入后，各种传感器也会同时接入 Home Assistant。</p>
<ol start="5">
<li>重新载入设备。</li>
</ol>
<h3 id="斐讯-DC1-插座"><a href="#斐讯-DC1-插座" class="headerlink" title="斐讯 DC1 插座"></a>斐讯 DC1 插座</h3><p>斐讯 DC1 插座接入有两种办法，一种是拆开刷机，另一种是 DNS 劫持（免拆机），可参考<a href="https://bbs.hassbian.com/forum.php?mod=viewthread&tid=5637&highlight=dc1" target="_blank" rel="noopener">这篇</a>，免拆机具体做法：</p>
<ol>
<li><p>在路由器设置界面设置 DNS 劫持，不同路由器设置地方不相同， OpenWrt 可以在「网络」→「主机名」中修改，添加 <code>smartplugconnect.phicomm.com</code> 到 <code>群晖 IP</code><br><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_dns.png" alt="ha2_dns"></p>
</li>
<li><p>下载帖子中的「WiFi智能插座」 apk 文件，将插座连入 WiFi，在路由器中找到插座的 IP 地址，</p>
</li>
<li><p>下载配置源码，将对应文件放进对应文件夹，修改 <code>/packages</code> 下的 configuration.yaml 文件，将 IP 改为群晖 IP，设备名字自定义，</p>
</li>
<li><p>重新载入设备。</p>
</li>
</ol>
<h3 id="Chromecast"><a href="#Chromecast" class="headerlink" title="Chromecast"></a>Chromecast</h3><p>Home Assistant 可以自动发现局域网内的 Chromecast 设备，如 Google Home、 Chromecast、 Android TV 等，按照页面设置即可若想手动配置，可以参考<a href="https://www.home-assistant.io/integrations/cast/" target="_blank" rel="noopener">这里</a>。</p>
<p>另外，Google Home 还可以作为一个 TTS 设备。</p>
<h2 id="设备分组"><a href="#设备分组" class="headerlink" title="设备分组"></a>设备分组</h2><p>Home Assistant 调整 UI 很方便，只要点击右上角「三个点」，之后选择「配置 UI」，之后可以添加、删除设备。</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_homekit.png" alt="ha2_homekit"></p>
<h2 id="接入语音平台"><a href="#接入语音平台" class="headerlink" title="接入语音平台"></a>接入语音平台</h2><p>Home Assistant 可以接入 HomeKit、Google Assitant、Alexa，使用 Siri、Google、Alexa 控制设备。</p>
<h3 id="HomeKit"><a href="#HomeKit" class="headerlink" title="HomeKit"></a>HomeKit</h3><p>在 configuration.yaml 文件添加以下代码，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">homekit:</span><br></pre></td></tr></table></figure>
<p>打开 iOS设备的 Home App，选择「添加设备」，之后选择「我没有设置码或不能扫码」→「手动输码」，</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_ui.png" alt="ha2_u"></p>
<p>Home Assistant 会发一条通知，填入通知内的数字即可接入 HomeKit。</p>
<p>若想手动配置，可以参照<a href="https://www.home-assistant.io/integrations/homekit/" target="_blank" rel="noopener">这篇</a>。</p>
<h3 id="Google-Assitant"><a href="#Google-Assitant" class="headerlink" title="Google Assitant"></a>Google Assitant</h3><p>Home Assistant 接入 Google Assitant 步骤较多，参考<a href="https://www.home-assistant.io/integrations/google_assistant/" target="_blank" rel="noopener">这里</a>，以后专门文章写，想简单体验可以这样：</p>
<ol>
<li>访问 <a href="https://www.nabucasa.com/，点击右上角「开始使用」，输入邮箱、密码，并验证邮箱，" target="_blank" rel="noopener">https://www.nabucasa.com/，点击右上角「开始使用」，输入邮箱、密码，并验证邮箱，</a></li>
<li>在 Home Assistant 页面中登录 Home Assistant Cloud，在Google Assistant App 中添加设备，搜索「home assistant」，绑定注册的账号，体验时间是 30 天。</li>
</ol>
<h3 id="Alexa"><a href="#Alexa" class="headerlink" title="Alexa"></a>Alexa</h3><p>Alexa 设置可以参考<a href="https://www.home-assistant.io/integrations/alexa/" target="_blank" rel="noopener">这里</a>，也可以利用 Home Assistant Cloud 体验。 </p>
<h2 id="外网访问"><a href="#外网访问" class="headerlink" title="外网访问"></a>外网访问</h2><p>外网访问 Home Assistant 可以利用公网 IP 和 DDNS 实现，公网 IP 需要向运营商申请，DDNS 可以直接利用群晖自带的 DDNS。</p>
<p>打开群晖控制面板，在「外部访问」中的「DDNS」中选择「添加」，之后可以申请域名，也可以用自己的域名，</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_ddns1.png" alt="ha2_ddns1"></p>
<p>在路由器中设置 DDNS，如 OpenWrt 可以在「网络」→「防火墙」中添加一条记录。</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic@master/uPic/ha2_ddns2.png" alt="ha2_ddns2"></p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/Home-Assistant/" rel="tag"># Home Assistant</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="Home Assistant 系列——DIY 篇（上）" href="/ha3/">
            ← Home Assistant 系列——DIY 篇（上）
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="Home Assistant 系列——Docker 安装篇" href="/ha1/">
            Home Assistant 系列——Docker 安装篇 →
        </a>
        
    </nav>

    
</div>






	</div>
	


	




<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="庄菲什">庄菲什 &copy; 2022</a>
			
				
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        

        
        

        
        
    })
</script>










</body>
</html>
