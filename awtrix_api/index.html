<!DOCTYPE html>
<html lang="zh-CN">







<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>HA 联动像素钟 | 庄菲什</title>

	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
	<meta name="generator" content="hexo">
	<meta name="author" content="drunkfish">
	<meta name="description" content="">

	

	

	

	

	

	<meta property="og:site_name" content="庄菲什">
	<meta property="og:type" content="article">
	<meta property="og:title" content="HA 联动像素钟 | 庄菲什">
	<meta property="og:description" content="">
	<meta property="og:url" content="http://yoursite.com/awtrix_api/">

	
	<meta property="article:published_time" content="2021-03-28T00:03:00+08:00"/> 
	<meta property="article:author" content="drunkfish">
	<meta property="article:published_first" content="庄菲什, /awtrix_api/" />
	

	
	
	
<link rel="stylesheet" href="/css/allinonecss.min.css">


	
	
	
<link rel="alternate" href="/atom.xml" title="庄菲什" type="application/atom+xml">
</head>
<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">HOME</a>
                
            </li>
            
        </ul> 
    </div>
     
    <div class="site-nav-right">
         
        
<div class="social-links" >
    
    
    
    
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time  class="post-full-meta-date" datetime="2021-03-28T00:00:00.000Z">
                    2021-03-28
                </time>
                
                <span class="date-divider">/</span>
                
                
            </div>
            <h1 class="post-full-title">HA 联动像素钟</h1>
        </header>
        <div class="post-full no-image">
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic3@master/uPic/awtrix_api_cover.png" alt="awtrix_api_cover"></p>
<p>小弟曾做过一个像素钟 <a href="https://lametric.com/en-US" target="_blank" rel="noopener">LaMetric Time</a> 的 DIY 替代品 AWTRIX，有 8*32 个像素，可以显示像素动画、文字信息的等等。比较酷的是， AWTRIX 支持外部控制，这样就可以与其他设备联动。</p>
<p>AWTRIX 可以通过 HTTP 和 MQTT 两种方式从外部控制，控制的元素很多，从显示图标、显示特定文字等都可以，详见 AWTRIX 文档 <a href="https://awtrixdocs.blueforcer.de/#/en-en/api" target="_blank" rel="noopener">API 部分</a>。以下实例介绍 AWTRIX 与 Home Assistant 的联动：</p>
<h2 id="利用-HTTP"><a href="#利用-HTTP" class="headerlink" title="利用 HTTP"></a>利用 HTTP</h2><p>实例：通过 HTTP 定时控制像素灯泡开关</p>
<p>AWTRIX 某种意义算是一个灯泡组合的信息版，可惜这个灯泡组合不能方便地打开/关闭显示屏幕，有大大利用 HTTP <a href="https://bbs.iobroker.cn/t/topic/3509" target="_blank" rel="noopener">将 AWTRIX 虚拟成一个灯光开关接入</a>，将以下代码复制粘贴至 configuration.yaml 文件即可（记得将 AWTRIX-SERVER_IP 替换成实际 IP ）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">light:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">template</span></span><br><span class="line">    <span class="attr">lights:</span></span><br><span class="line">      <span class="attr">theater_volume:</span></span><br><span class="line">        <span class="attr">friendly_name:</span> <span class="string">Steam</span></span><br><span class="line">        <span class="attr">turn_on:</span></span><br><span class="line">          <span class="attr">service:</span> <span class="string">shell_command.turn_on_123</span></span><br><span class="line">        <span class="attr">turn_off:</span></span><br><span class="line">          <span class="attr">service:</span> <span class="string">shell_command.turn_off_541</span></span><br><span class="line"></span><br><span class="line"><span class="attr">shell_command:</span></span><br><span class="line">  <span class="attr">turn_off_541:</span> <span class="string">'curl --header "Content-Type: application/json" --request POST --data &#123;"power":false&#125; http://[AWTRIX-SERVER_IP]/api/v3/basics'</span></span><br><span class="line">  <span class="attr">turn_on_123:</span> <span class="string">'curl --header "Content-Type: application/json" --request POST --data &#123;"power":true&#125; http://[AWTRIX-SERVER_IP]:7000/api/v3/basics'</span></span><br></pre></td></tr></table></figure>

<p>加入虚拟开关后，就可以通过自动化控制像素时钟的显示与关闭，如可以设置定时开关屏幕，每天 7 点自动打开屏幕， 晚上 11 点关闭屏幕，自动化配置参考：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">'xxxxx'</span></span><br><span class="line">  <span class="attr">alias:</span> <span class="string">awtrix</span> <span class="string">on</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">''</span></span><br><span class="line">  <span class="attr">trigger:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">time</span></span><br><span class="line">    <span class="attr">at:</span> <span class="string">'7:00'</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">action:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">switch.turn_on</span></span><br><span class="line">    <span class="attr">data:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">entity_id:</span> <span class="string">switch.original_xiaomi_mi_smart_wifi_socket</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">single</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">'xxxxx'</span></span><br><span class="line">  <span class="attr">alias:</span> <span class="string">awtrix</span> <span class="string">off</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">''</span></span><br><span class="line">  <span class="attr">trigger:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">time</span></span><br><span class="line">    <span class="attr">at:</span> <span class="string">'23:00'</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">action:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">shell_command.turn_off_541</span></span><br><span class="line">    <span class="attr">data:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">single</span></span><br></pre></td></tr></table></figure>

<h2 id="利用-MQTT"><a href="#利用-MQTT" class="headerlink" title="利用 MQTT"></a>利用 MQTT</h2><p>实例：通过 MQTT 实现扫描特定 NFC 标签（或其他条件）显示「降落文字」（falling test）</p>
<p>首先可以在 AWTRIX 设置好 MQTT 服务器，设置成功在 MQTT 服务器中可以看到 awtrix 相关的主题，AWTRIX 基本主题是<code>awtrix</code>。</p>
<p>这里示例扫描特定 NFC 标签（或其他条件）显示「降落文字」，自动化配置参考：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">'xxxxx'</span></span><br><span class="line">  <span class="attr">alias:</span> <span class="string">Tag</span> <span class="string">blue</span> <span class="string">is</span> <span class="string">scanned</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">''</span></span><br><span class="line">  <span class="attr">trigger:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">tag</span></span><br><span class="line">    <span class="attr">tag_id:</span> <span class="string">xx-xx-xx-xx</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">action:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">mqtt.publish</span></span><br><span class="line">    <span class="attr">data:</span></span><br><span class="line">      <span class="attr">topic:</span> <span class="string">awtrix/notify</span></span><br><span class="line">      <span class="attr">payload:</span> <span class="string">'&#123;"name":"TestNotification", "force":true, "repeat":10,"fallingText":"keep cool", "color":[0, 255, 0]&#125;'</span></span><br><span class="line">  <span class="attr">mode:</span> <span class="string">single</span></span><br></pre></td></tr></table></figure>

<p>扫描 NFC 标签后， AWTRIX 先绿色字体显示「keep」，之后掉落显示「cool」。</p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/Home-Assistant/" rel="tag"># Home Assistant</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="Google 艺文的使用" href="/google_art/">
            ← Google 艺文的使用
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="自制 NFC 读卡器接入 HA" href="/nfc_reader/">
            自制 NFC 读卡器接入 HA →
        </a>
        
    </nav>

    
</div>






	</div>
	


	




<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="庄菲什">庄菲什 &copy; 2022</a>
			
				
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        

        
        

        
        
    })
</script>










</body>
</html>
