<!DOCTYPE html>
<html lang="zh-CN">







<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<link rel="preconnect" href="//www.googletagmanager.com">
	<link rel="preconnect" href="//zz.bdstatic.com">
	<link rel="preconnect" href="//sp0.baidu.com">
	<link rel="preconnect" href="//www.google-analytics.com">
	<link rel="preconnect" href="//cdn1.lncld.net">
	<link rel="preconnect" href="//unpkg.com">
	<link rel="preconnect" href="//app-router.leancloud.cn">
	<link rel="preconnect" href="//9qpuwspm.api.lncld.net">
	<link rel="preconnect" href="//gravatar.loli.net">

	<title>舵机控制普通单控 86 开关 | 庄菲什</title>

	<meta name="HandheldFriendly" content="True" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
	<meta name="generator" content="hexo">
	<meta name="author" content="drunkfish">
	<meta name="description" content="">

	

	

	

	

	

	<meta property="og:site_name" content="庄菲什">
	<meta property="og:type" content="article">
	<meta property="og:title" content="舵机控制普通单控 86 开关 | 庄菲什">
	<meta property="og:description" content="">
	<meta property="og:url" content="http://yoursite.com/servo/">

	
	<meta property="article:published_time" content="2020-10-24T00:10:00+08:00"/> 
	<meta property="article:author" content="drunkfish">
	<meta property="article:published_first" content="庄菲什, /servo/" />
	

	
	
	
<link rel="stylesheet" href="/css/allinonecss.min.css">


	
	
	
<link rel="alternate" href="/atom.xml" title="庄菲什" type="application/atom+xml">
</head>
<body class="post-template">
	<div class="site-wrapper">
		




<header class="site-header post-site-header outer">
    <div class="inner">
        
<nav class="site-nav"> 
    <div class="site-nav-left">
        <ul class="nav">
            <li>
                
                <a href="/" title="Home">HOME</a>
                
            </li>
            
        </ul> 
    </div>
     
    <div class="site-nav-right">
         
        
<div class="social-links" >
    
    
    
    
    
    
    
</div>
    </div>
</nav>
    </div>
</header>


<div id="site-main" class="site-main outer" role="main">
    <div class="inner">
        <header class="post-full-header">
            <div class="post-full-meta">
                <time  class="post-full-meta-date" datetime="2020-10-24T00:00:00.000Z">
                    2020-10-24
                </time>
                
                <span class="date-divider">/</span>
                
                
            </div>
            <h1 class="post-full-title">舵机控制普通单控 86 开关</h1>
        </header>
        <div class="post-full no-image">
            
            <div class="post-full-content">
                <article id="photoswipe" class="markdown-body">
                    <p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic3@master/uPic/servo_cover.png" alt="servo_cover"></p>
<p>小弟想将灯泡接入 HA，看到有大大通过舵机控制灯泡开关（参见<a href="https://taron.top/archives/108.html" target="_blank" rel="noopener">这里</a>），感觉思路很赞，那个大大是通过 Arduino 写固件，小弟觉得想用 ESPHome 实现，代码简单、有拓展性（可接入其他传感器之类的），尝试一番成功接入。</p>
<h2 id="材料准备"><a href="#材料准备" class="headerlink" title="材料准备"></a>材料准备</h2><p>1、ESP8266 开发板</p>
<p>2、SG90 9g 克舵机（90 度）</p>
<p>3、公对母杜邦线</p>
<p>4、公对母 USB 延长线（方便接电源）</p>
<p>5、90 度直角固定支架（或其他直角支架）</p>
<h2 id="刷入固件"><a href="#刷入固件" class="headerlink" title="刷入固件"></a>刷入固件</h2><p>确保安装好 ESPHome，HASS 可以直接通过插件安装。打开 ESPHome ，新建或打开已经或在原有设备新增以下代码：</p>
<p>ESP8266 参考：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">api:</span></span><br><span class="line">  <span class="attr">services:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">service:</span> <span class="string">control_servo</span></span><br><span class="line">      <span class="attr">variables:</span></span><br><span class="line">        <span class="attr">level:</span> <span class="string">float</span></span><br><span class="line">      <span class="attr">then:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">servo.write:</span></span><br><span class="line">            <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">            <span class="attr">level:</span> <span class="type">!lambda</span> <span class="string">'return level / 100.0;'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">servo:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">    <span class="attr">output:</span> <span class="string">pwm_output</span></span><br><span class="line"></span><br><span class="line"><span class="attr">output:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">esp8266_pwm</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">pwm_output</span></span><br><span class="line">    <span class="attr">pin:</span> <span class="string">D7</span></span><br><span class="line">    <span class="attr">frequency:</span> <span class="number">50</span> <span class="string">Hz</span></span><br><span class="line"></span><br><span class="line"><span class="attr">switch:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">gpio</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">"switch"</span></span><br><span class="line">    <span class="attr">pin:</span> <span class="string">D7</span></span><br><span class="line">    <span class="attr">on_turn_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">servo.write:</span></span><br><span class="line">          <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">          <span class="attr">level:</span> <span class="string">+100.0%</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="number">0.</span><span class="string">5s</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">servo.write:</span></span><br><span class="line">          <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">          <span class="attr">level:</span> <span class="number">0</span><span class="string">%</span>  </span><br><span class="line">    <span class="attr">on_turn_off:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">servo.write:</span></span><br><span class="line">          <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">          <span class="attr">level:</span> <span class="number">-100.0</span><span class="string">%</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="number">0.</span><span class="string">5s</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">servo.write:</span></span><br><span class="line">          <span class="attr">id:</span> <span class="string">my_servo</span></span><br><span class="line">          <span class="attr">level:</span> <span class="number">0</span><span class="string">%</span></span><br></pre></td></tr></table></figure>

<p>代码执行命令如下：按下「开」，正旋转 70%，500ms 之后回到初始位置；按下「关」，负旋转 70%，500ms 之后回到初始位置。注意角度可以按照实际情况修改。</p>
<p>在 Home Assistant 可以自动发现 ESPHome 设备，添加即可。</p>
<h2 id="连线"><a href="#连线" class="headerlink" title="连线"></a>连线</h2><p>首先将舵机与 ESP8266 连线，</p>
<table>
<thead>
<tr>
<th>舵机</th>
<th>ESP8266</th>
</tr>
</thead>
<tbody><tr>
<td>红色</td>
<td>3.3V</td>
</tr>
<tr>
<td>棕色</td>
<td>GND</td>
</tr>
<tr>
<td>黄色</td>
<td>D7</td>
</tr>
</tbody></table>
<p>将舵机、直角支架放在 86 开关上确定各自的距离，注意舵机旋转方向，用热熔胶粘在直角支架上，直角支架粘在墙上，舵机与开关可以留一定距离，这样不影响手动开关。</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic3@master/uPic/servo_pic1.jpg" alt="servo_pic1"></p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic3@master/uPic/servo_pic2.jpg" alt="servo_pic2"></p>
<p>距离可参考小弟的：</p>
<p><img src="https://cdn.jsdelivr.net/gh/drunkfish7/pic3@master/uPic/servo_distance2.png" alt="servo_distance"></p>
<p>粘上后最好等待 24 小时热熔胶固定再使用。</p>

                </article>
                <ul class="tags-postTags">
                    
                    <li>
                        <a href="/tags/Home-Assistant/" rel="tag"># Home Assistant</a>
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    
    <nav id="gobottom" class="pagination">
        
        <a class="prev-post" title="制作使用网址导航" href="/nav/">
            ← 制作使用网址导航
        </a>
        
        <span class="prev-next-post">·</span>
        
        <a class="next-post" title="自制超酷的 Zigbee 网关" href="/z2m/">
            自制超酷的 Zigbee 网关 →
        </a>
        
    </nav>

    
</div>






	</div>
	


	




<footer class="site-footer outer">
	<div class="site-footer-content inner">
		<div class="copyright">
			<a href="/" title="庄菲什">庄菲什 &copy; 2022</a>
			
				
    		
		</div>
		<nav class="site-footer-nav">
			
			<a href="https://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a>
			<a href="https://github.com/xzhih/hexo-theme-casper" title="Casper" target="_blank" rel="noopener">Casper</a>
		</nav>
	</div>
</footer>
	


<script>
    if(window.navigator && navigator.serviceWorker) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
            for(let registration of registrations) {
                registration.unregister()
            }
        })
    }
</script>


<script id="scriptLoad" src="/js/allinone.min.js" async></script>


<script>
    document.getElementById('scriptLoad').addEventListener('load', function () {
        
        

        
        

        
        
    })
</script>










</body>
</html>
